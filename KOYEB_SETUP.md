# 🚀 Деплой на Koyeb с автопингом (бот не будет засыпать!)

## 📋 Что мы делаем:

1. ✅ Разворачиваем бота на **Koyeb**
2. ✅ Настраиваем **UptimeRobot** для автопинга
3. ✅ Бот работает **24/7 бесплатно!**

---

## Часть 1: Деплой на Koyeb

### Шаг 1: Подготовка кода

Код уже готов! У бота есть HTTP endpoint на порту 8080:
- `http://your-app-url/` - проверка здоровья
- `http://your-app-url/health` - тоже проверка

### Шаг 2: Регистрация на Koyeb

1. Зайдите на https://www.koyeb.com/
2. Нажмите **"Sign Up"**
3. Войдите через **GitHub**

### Шаг 3: Создание приложения

1. Нажмите **"Create App"**
2. Выберите **"GitHub"**
3. **Подключите репозиторий:**
   - Authorize Koyeb
   - Выберите репозиторий `music-bot`
   - Branch: `main`

### Шаг 4: Настройка

```
Service type: Web Service
Builder: Buildpack (автоопределение)
Instance type: Free (Nano)

Build:
- Build command: pip install -r requirements.txt
- Run command: python bot.py

Port: 8080 (важно!)

Environment Variables:
┌──────────────┬────────────────────────────────────────────────────┐
│ Key          │ Value                                              │
├──────────────┼────────────────────────────────────────────────────┤
│ BOT_TOKEN    │ 8353650126:AAGvR3EoPXWeyCMkDIB8gDR7NwXx1REMbwQ     │
│ PORT         │ 8080                                               │
│ PROXY        │ (оставить пустым или указать прокси)              │
└──────────────┴────────────────────────────────────────────────────┘
```

### Шаг 5: Deploy!

1. Нажмите **"Deploy"**
2. Ждите 2-3 минуты
3. Скопируйте URL приложения (например: `https://music-bot-xxxxx.koyeb.app`)

---

## Часть 2: Настройка UptimeRobot (автопинг)

### Шаг 1: Регистрация

1. Зайдите на https://uptimerobot.com/
2. Нажмите **"Free Sign Up"**
3. Подтвердите email

### Шаг 2: Создание монитора

1. В панели нажмите **"+ Add New Monitor"**

2. **Настройте:**
   ```
   Monitor Type: HTTP(s)
   Friendly Name: Music Bot Keep-Alive
   URL: https://music-bot-xxxxx.koyeb.app/health
   Monitoring Interval: 5 minutes (бесплатно)
   ```

3. Нажмите **"Create Monitor"**

### Шаг 3: Готово!

✅ UptimeRobot будет пинговать бота каждые 5 минут
✅ Бот не будет засыпать
✅ Вы получите уведомления если бот упадет

---

## Альтернатива UptimeRobot:

### **Cron-job.org** (пингает чаще)

1. Зайдите на https://cron-job.org/
2. Регистрация
3. **Create cronjob:**
   ```
   Title: Music Bot Ping
   URL: https://your-koyeb-app.koyeb.app/health
   Execution: Every 1 minute (бесплатно!)
   ```
4. Save

**Преимущество:** пингует каждую минуту вместо 5!

---

## 🔍 Проверка работы:

### 1. Проверьте бота в Telegram:
- Напишите `/start`
- Должен ответить сразу

### 2. Проверьте HTTP endpoint:
Откройте в браузере:
```
https://your-koyeb-app.koyeb.app/health
```

Должно показать:
```
Bot is alive! 🎵
```

### 3. Проверьте логи на Koyeb:
- Зайдите в приложение
- Вкладка "Logs"
- Должно быть:
  ```
  INFO - 🚀 Запуск бота...
  INFO - 🌐 HTTP сервер запущен на порту 8080
  INFO - Start polling
  ```

---

## 📊 Результат:

| Параметр | Значение |
|----------|----------|
| **Стоимость** | ✅ Бесплатно |
| **Работает 24/7** | ✅ Да |
| **Засыпает** | ❌ Нет (пинг каждые 5 мин) |
| **YouTube работает** | ✅ Да |
| **Прокси нужен** | ⚠️ Возможно (проверьте) |

---

## 🐛 Решение проблем:

### Бот не отвечает в Telegram:

1. Проверьте логи на Koyeb
2. Проверьте переменную `BOT_TOKEN`
3. Убедитесь что webhook удален:
   ```
   https://api.telegram.org/bot<TOKEN>/deleteWebhook
   ```

### HTTP endpoint не открывается:

1. Проверьте что порт `8080` указан в настройках
2. Проверьте логи - должно быть "HTTP сервер запущен"
3. Подождите 2-3 минуты после деплоя

### YouTube не скачивает:

1. Попробуйте добавить `PROXY` (см. PROXY_SETUP.md)
2. Или YouTube работает без прокси на Koyeb!

---

## 💡 Советы:

1. **UptimeRobot** отправит вам email если бот упадет
2. **Не удаляйте** HTTP endpoints - они нужны для пинга
3. **Koyeb free tier:** 2 сервиса бесплатно
4. Если нужно больше - используйте **Oracle Cloud** (бесплатно навсегда)

---

## 🎯 Итого:

- ✅ Бот на Koyeb (бесплатно)
- ✅ Автопинг через UptimeRobot (бесплатно)
- ✅ Работает 24/7
- ✅ Не засыпает
- ✅ Мониторинг здоровья

**Готово! Ваш бот работает круглосуточно бесплатно! 🎵🚀**
